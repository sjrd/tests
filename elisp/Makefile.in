BUILDTOP=	@BUILDTOP@
PREFIX=		@prefix@

SRCDIR		= @srcdir@
ELISPDIR	= $(PREFIX)/lib/elisp

EMACS		= @THEEMACS@
ECHO		= @ECHO@
RM		= @RM@ -f

INSTALL		= @INSTALL@
INSTALLFILE	= $(INSTALL) -m 444
INSTALLSRC	= @INSTALLSRC@
MKINSTALLDIRS	= @MKINSTALLDIRS@

LIBFILES = $(ELISPDIR)/oz.el $(ELISPDIR)/oz.elc

.PHONY: bootstrap all install clean veryclean realclean distclean tags

all: Makefile oz.elc

bootstrap: all

oz.el: oz.el.in ../config.status
	cd .. && ./config.status

Makefile: Makefile.in ../config.status
	cd .. && ./config.status

../config.status: ../configure
	cd .. && ./config.status --recheck

oz.elc: oz.el
	@$(ECHO) "(setq byte-compile-compatibility t) \
	(byte-compile-file \"$<\")" > compile.el
	$(EMACS) -q -batch -l compile.el
	@$(RM) compile.el

install: all $(ELISPDIR) $(LIBFILES)

$(ELISPDIR):
	$(MKINSTALLDIRS) $@

$(ELISPDIR)/%.el: $(SRCDIR)/%.el
	$(INSTALLSRC) $< $@

$(ELISPDIR)/%.elc: %.elc
	$(INSTALLFILE) $< $@

clean:
	$(RM) *.elc *~ TAGS

veryclean: clean

realclean: clean

distclean: clean
	$(RM) Makefile oz.el

tags:
	etags oz.el

