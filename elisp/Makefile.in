PREFIX=		@prefix@

SRCDIR		= @srcdir@
ELISPDIR	= $(PREFIX)/lib/elisp

EMACS		= @THEEMACS@
ECHO		= @ECHO@
RM		= @RM@ -f

INSTALL		= @INSTALL@
INSTALLFILE	= $(INSTALL) -m 444
INSTALLSRC	= @INSTALLSRC@
MKINSTALLDIRS	= @MKINSTALLDIRS@

LIBFILES = $(ELISPDIR)/oz.el $(ELISPDIR)/oz.elc

.PHONY: all install clean veryclean realclean distclean tags

all: oz.elc

oz.elc: oz.el
	@$(ECHO) "(setq byte-compile-compatibility t) \
	(byte-compile-file \"$<\")" > compile.el
	$(EMACS) -q -batch -l compile.el
	@$(RM) compile.el

install: all $(ELISPDIR) $(LIBFILES)

$(ELISPDIR):
	$(MKINSTALLDIRS) $@

$(ELISPDIR)/%.el: $(SRCDIR)/%.el
	$(INSTALLSRC) $< $@

$(ELISPDIR)/%.elc: %.elc
	$(INSTALLFILE) $< $@

clean:
	$(RM) *.elc *~ TAGS

veryclean: clean

realclean: clean

distclean:
	$(RM) Makefile

tags:
	etags oz.el

