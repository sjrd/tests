#  Authors:
#    Michael Mehl (mehl@dfki.de)
# 
#  Contributors:
#    optional, Contributor's name (Contributor's email address)
# 
#  Copyright:
#    Michael Mehl, 1998
# 
#  Last change:
#    $Date$ by $Author$
#    $Revision$
# 
#  This file is part of Mozart, an implementation 
#  of Oz 3:
#     $MOZARTURL$
# 
#  See the file "LICENSE" or
#     $LICENSEURL$
#  for information on usage and redistribution 
#  of this file, and for a DISCLAIMER OF ALL 
#  WARRANTIES.

BUILDTOP=	@BUILDTOP@
PREFIX=		@prefix@

VPATH		= @srcdir@
SRCDIR		= @srcdir@
ELISPDIR	= $(PREFIX)/lib/elisp

EMACS		= @THEEMACS@

INSTALL		= @INSTALL@
INSTALL_FILE	= $(INSTALL) -m 444
INSTALL_SRC	= @INSTALL_SRC@
INSTALL_DIR	= @INSTALL_DIR@

LIBFILES = $(ELISPDIR)/oz.el $(ELISPDIR)/oz.elc

.PHONY: bootstrap all install clean veryclean distclean tags

all: oz.elc

bootstrap: all

oz.el: oz.el.in ../config.status
	cd .. && ./config.status

Makefile: Makefile.in ../config.status
	cd .. && ./config.status

../config.status: ../configure
	cd .. && ./config.status --recheck

oz.elc: oz.el
	@echo "(setq byte-compile-compatibility t) \
	(byte-compile-file \"$<\")" > compile.el
	$(EMACS) -q -batch -l compile.el
	@rm -f compile.el

install: all $(ELISPDIR) $(LIBFILES)

$(ELISPDIR):
	$(INSTALL_DIR) $@

$(ELISPDIR)/%.el: $(SRCDIR)/%.el
	$(INSTALL_SRC) $< $@

$(ELISPDIR)/%.elc: %.elc
	$(INSTALL_FILE) $< $@

clean:
	-rm -f *.elc *~ TAGS

veryclean: clean

distclean: clean
	-rm -f Makefile oz.el

tags:
	etags oz.el

check:
